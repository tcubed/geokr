{% extends "base.html" %}

{% block title %}
Geokr{% if game and game.name %} - {{ game.name }}{% endif %}
{% endblock %}
{% block head %}
{% endblock %}

{% block content %}

<div id="cached-tiles-container" style="display:flex; flex-wrap: wrap; gap: 5px;"></div>

<script>
  async function showCachedTiles(cacheName = 'tile-cache') {
  const container = document.getElementById('cached-tiles-container');
  container.innerHTML = '<p>Loading cached tiles...</p>';

  try {
    const cache = await caches.open(cacheName);
    const requests = await cache.keys();
    container.innerHTML = `<p>Found ${requests.length} cached requests in '${cacheName}':</p>`;

    for (const req of requests) {
      const url = req.url;
      const div = document.createElement('div');
      div.style.border = '1px solid #ccc';
      div.style.padding = '4px';
      div.style.width = '120px';
      div.style.textAlign = 'center';
      div.style.fontSize = '10px';
      div.style.wordBreak = 'break-word';

      div.textContent = url;

      try {
        const response = await cache.match(req);
        if (response) {
          const blob = await response.blob();
          // Try to create an image URL from blob for any response
          const img = document.createElement('img');
          img.src = URL.createObjectURL(blob);
          img.style.width = '100px';
          img.style.height = '100px';
          img.style.objectFit = 'contain';
          img.style.display = 'block';
          img.style.margin = '5px auto';

          div.prepend(img);
        }
      } catch (imgErr) {
        console.warn('Could not display image for', url, imgErr);
      }

      container.appendChild(div);
    }
  } catch (err) {
    container.innerHTML = `<p style="color:red;">Error: ${err}</p>`;
    console.error(err);
  }
}

showCachedTiles('tile-cache');

</script>

{% endblock %}

