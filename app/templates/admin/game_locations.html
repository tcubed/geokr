{% extends "base.html" %}
{% block title %}Manage Game Locations{% endblock %}

{% block head %}
<style>
.loc-name {
  font-size: 1.25rem;
  font-weight: 500;
  border: none;
  background: transparent;
}
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>Manage Locations</h2>

  <div class="mb-3">
    <label for="gameSelect" class="form-label">Select a game:</label>
    <select class="form-select" id="gameSelect">
      <option value="" disabled selected>Select a game</option>
      {% for g in games %}
        <option value="{{ g.id }}">{{ g.name }}</option>
      {% endfor %}
    </select>
  </div>

  <div class="mb-3">
    <label for="filterInput" class="form-label">Filter locations:</label>
    <input type="text" class="form-control" id="filterInput" placeholder="Search by name, clue text, or image">
  </div>

  <div id="locationsContainer" class="row g-3"></div>

  <div id="sync-toast-container" style="position: fixed; bottom: 20px; right: 20px; max-width: 300px;"></div>
</div>

<!-- Image Upload Modal -->
<div class="modal fade" id="uploadImageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form id="uploadImageForm" class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Upload Image</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label for="imageFile" class="form-label">Select image file:</label>
          <input type="file" class="form-control" id="imageFile" name="image" accept="image/*" required>
          <img id="imagePreview" class="img-thumbnail mt-2" style="display:none; max-width: 100%; height: auto;">
        </div>
        <div class="mb-3">
          <label for="imageDir" class="form-label">Directory:</label>
          <select class="form-select" id="imageDir" name="directory">
            <!-- dynamically populated -->
          </select>
          <input type="text" class="form-control mt-2" id="newDirName" placeholder="Or create new directory">
        </div>
        <div class="mb-3">
          <label for="targetFilename" class="form-label">Target file name:</label>
          <input type="text" class="form-control" id="targetFilename" placeholder="image.png" required>
        </div>
      </div>
      
      <div class="modal-footer">
        <button type="submit" class="btn btn-primary">Upload</button>
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </form>
  </div>
</div>

<script type="module">
  const VERSION = "{{ version }}";
  console.log('VERSION: ', VERSION)
</script>
<script type="module" src="{{ url_for('static', filename='js/account.js') }}?v={{ version }}"></script>

<script type="module" src="{{ url_for('static', filename='js/game_locations.js') }}?v={{ version }}"></script>
{% endblock %}
